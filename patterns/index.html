<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://jeromeboyer.net/eda-studies/patterns/ rel=canonical><link href=../methodology/event-storming/vaccine-dt-es-ddd/ rel=prev><link href=events-versus-messages/ rel=next><link rel=icon href=../images/logo-blue.drawio.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Common patterns - Event-Driven Solutions in Hybrid Cloud - Jerome Boyer</title><link rel=stylesheet href=../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#distributed-systems-common-design-patterns class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" class="md-header__button md-logo" aria-label="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" data-md-component=logo> <img src=../images/logo.drawio.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Event-Driven Solutions in Hybrid Cloud - Jerome Boyer </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Common patterns </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/eda-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../concepts/eda/ class=md-tabs__link> EDA concepts </a> </li> <li class=md-tabs__item> <a href=../methodology/event-storming/ class=md-tabs__link> Methodology </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Design patterns </a> </li> <li class=md-tabs__item> <a href=../methodology/getting-started/ class=md-tabs__link> Demonstrations </a> </li> <li class=md-tabs__item> <a href=../techno/kafka/ class=md-tabs__link> Technologies </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" class="md-nav__button md-logo" aria-label="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" data-md-component=logo> <img src=../images/logo.drawio.png alt=logo> </a> Event-Driven Solutions in Hybrid Cloud - Jerome Boyer </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/eda-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> EDA concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> EDA concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../concepts/eda/ class=md-nav__link> <span class=md-ellipsis> Reference architecture </span> </a> </li> <li class=md-nav__item> <a href=../concepts/soa-eda/ class=md-nav__link> <span class=md-ellipsis> From SOA to EDA </span> </a> </li> <li class=md-nav__item> <a href=../concepts/backbone/ class=md-nav__link> <span class=md-ellipsis> Messaging backbone </span> </a> </li> <li class=md-nav__item> <a href=../concepts/legacy-itg/ class=md-nav__link> <span class=md-ellipsis> Legacy integration </span> </a> </li> <li class=md-nav__item> <a href=../concepts/data-pipeline/ class=md-nav__link> <span class=md-ellipsis> Data pipeline </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Methodology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../methodology/event-storming/ class=md-nav__link> <span class=md-ellipsis> Event Storming </span> </a> </li> <li class=md-nav__item> <a href=../methodology/ddd/ class=md-nav__link> <span class=md-ellipsis> Domain driven design </span> </a> </li> <li class=md-nav__item> <a href=../methodology/ddd/eda_assessment/ class=md-nav__link> <span class=md-ellipsis> EDA Assessment </span> </a> </li> <li class=md-nav__item> <a href=../methodology/event-storming/vaccine-dt-es-ddd/ class=md-nav__link> <span class=md-ellipsis> Vaccine Examples </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Design patterns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Design patterns </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Common patterns </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Common patterns </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#microservice-challenges class=md-nav__link> <span class=md-ellipsis> Microservice challenges </span> </a> </li> <li class=md-nav__item> <a href=#common-patterns class=md-nav__link> <span class=md-ellipsis> Common Patterns </span> </a> </li> <li class=md-nav__item> <a href=#strangler-pattern class=md-nav__link> <span class=md-ellipsis> Strangler pattern </span> </a> <nav class=md-nav aria-label="Strangler pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#solution class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#choreography class=md-nav__link> <span class=md-ellipsis> Choreography </span> </a> </li> <li class=md-nav__item> <a href=#orchestration class=md-nav__link> <span class=md-ellipsis> Orchestration </span> </a> </li> <li class=md-nav__item> <a href=#scatter-gather class=md-nav__link> <span class=md-ellipsis> Scatter-gather </span> </a> </li> <li class=md-nav__item> <a href=#transactional-outbox class=md-nav__link> <span class=md-ellipsis> Transactional outbox </span> </a> </li> <li class=md-nav__item> <a href=#integration-patterns class=md-nav__link> <span class=md-ellipsis> Integration patterns </span> </a> <nav class=md-nav aria-label="Integration patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#one-way-asynchronous class=md-nav__link> <span class=md-ellipsis> One-way asynchronous </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=events-versus-messages/ class=md-nav__link> <span class=md-ellipsis> Messaging vs events </span> </a> </li> <li class=md-nav__item> <a href=model/ class=md-nav__link> <span class=md-ellipsis> Devising the data models </span> </a> </li> <li class=md-nav__item> <a href=api-mgt/ class=md-nav__link> <span class=md-ellipsis> API management </span> </a> </li> <li class=md-nav__item> <a href=saga/ class=md-nav__link> <span class=md-ellipsis> Saga </span> </a> </li> <li class=md-nav__item> <a href=event-sourcing/ class=md-nav__link> <span class=md-ellipsis> Event Sourcing </span> </a> </li> <li class=md-nav__item> <a href=cqrs/ class=md-nav__link> <span class=md-ellipsis> CQRS </span> </a> </li> <li class=md-nav__item> <a href=reactive/ class=md-nav__link> <span class=md-ellipsis> Reactive </span> </a> </li> <li class=md-nav__item> <a href=flow-architectures/ class=md-nav__link> <span class=md-ellipsis> Flow architecture </span> </a> </li> <li class=md-nav__item> <a href=dlq/ class=md-nav__link> <span class=md-ellipsis> Dead letter queue </span> </a> </li> <li class=md-nav__item> <a href=data-lineage/ class=md-nav__link> <span class=md-ellipsis> Data lineage </span> </a> </li> <li class=md-nav__item> <a href=governance/ class=md-nav__link> <span class=md-ellipsis> Governance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Demonstrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Demonstrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../methodology/getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../techno/kafka/playground/ class=md-nav__link> <span class=md-ellipsis> Sandbox notes </span> </a> </li> <li class=md-nav__item> <a href=../solutions/gitops_IaC/ class=md-nav__link> <span class=md-ellipsis> GitOps - IaC </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/eda-rt-inventory/ class=md-nav__link> <span class=md-ellipsis> Real-time Inventory </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Technologies </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Technologies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../techno/kafka/ class=md-nav__link> <span class=md-ellipsis> Kafka </span> </a> </li> <li class=md-nav__item> <a href=../techno/kafka/faq/ class=md-nav__link> <span class=md-ellipsis> Kafka FAQ </span> </a> </li> <li class=md-nav__item> <a href=../techno/kafka/producer/ class=md-nav__link> <span class=md-ellipsis> Kafka Producer </span> </a> </li> <li class=md-nav__item> <a href=../techno/kafka/consumer/ class=md-nav__link> <span class=md-ellipsis> Kafka Consumer </span> </a> </li> <li class=md-nav__item> <a href=../techno/kafka/security/ class=md-nav__link> <span class=md-ellipsis> Kafka Security </span> </a> </li> <li class=md-nav__item> <a href=../techno/avro-schemas/ class=md-nav__link> <span class=md-ellipsis> Schema Mgt </span> </a> </li> <li class=md-nav__item> <a href=../techno/kstreams/ class=md-nav__link> <span class=md-ellipsis> Kafka Streams </span> </a> </li> <li class=md-nav__item> <a href=../techno/kafka-connect/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=../techno/confluent/ class=md-nav__link> <span class=md-ellipsis> Confluent </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/redpanda-studies/ class=md-nav__link> <span class=md-ellipsis> RedPanda </span> </a> </li> <li class=md-nav__item> <a href=../techno/mirrormaker/ class=md-nav__link> <span class=md-ellipsis> Mirror Maker 2 </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/flink-studies class=md-nav__link> <span class=md-ellipsis> Flink </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/activemq/ class=md-nav__link> <span class=md-ellipsis> Active MQ </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Rabbit MQ </span> </a> </li> <li class=md-nav__item> <a href=../solutions/autonomous-car/es-duplicate-evt/ class=md-nav__link> <span class=md-ellipsis> AWS duplicate with EB </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/yarfba/kinesis class=md-nav__link> <span class=md-ellipsis> AWS Kinesis </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/yarfba/serverless/msk class=md-nav__link> <span class=md-ellipsis> AWS MSK </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study class=md-nav__link> <span class=md-ellipsis> AWS messaging </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/sqs/ class=md-nav__link> <span class=md-ellipsis> AWS SQS </span> </a> </li> <li class=md-nav__item> <a href=../ibm-assets/ class=md-nav__link> <span class=md-ellipsis> IBM Assets </span> </a> </li> <li class=md-nav__item> <a href=../techno/ibm-mq/ class=md-nav__link> <span class=md-ellipsis> IBM MQ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#microservice-challenges class=md-nav__link> <span class=md-ellipsis> Microservice challenges </span> </a> </li> <li class=md-nav__item> <a href=#common-patterns class=md-nav__link> <span class=md-ellipsis> Common Patterns </span> </a> </li> <li class=md-nav__item> <a href=#strangler-pattern class=md-nav__link> <span class=md-ellipsis> Strangler pattern </span> </a> <nav class=md-nav aria-label="Strangler pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#solution class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#choreography class=md-nav__link> <span class=md-ellipsis> Choreography </span> </a> </li> <li class=md-nav__item> <a href=#orchestration class=md-nav__link> <span class=md-ellipsis> Orchestration </span> </a> </li> <li class=md-nav__item> <a href=#scatter-gather class=md-nav__link> <span class=md-ellipsis> Scatter-gather </span> </a> </li> <li class=md-nav__item> <a href=#transactional-outbox class=md-nav__link> <span class=md-ellipsis> Transactional outbox </span> </a> </li> <li class=md-nav__item> <a href=#integration-patterns class=md-nav__link> <span class=md-ellipsis> Integration patterns </span> </a> <nav class=md-nav aria-label="Integration patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#one-way-asynchronous class=md-nav__link> <span class=md-ellipsis> One-way asynchronous </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=distributed-systems-common-design-patterns>Distributed systems common design patterns<a class=headerlink href=#distributed-systems-common-design-patterns title="Permanent link">&para;</a></h1> <p>In this set of articles, we will detail some of the most important event-driven design patterns that can be used during an event-driven microservice implementation.</p> <h2 id=microservice-challenges>Microservice challenges<a class=headerlink href=#microservice-challenges title="Permanent link">&para;</a></h2> <p>As we have seen in the <a href=../concepts/eda/ >introduction</a>, modern business application needs to responds to events in real time, as the events happen, so it can deliver better user experiences and apply business logic on those events. The key is to be able to act quickly on those facts. Acting may involve computing real-time analytics or use predictive scoring with machine trained models. </p> <p>On top of that, a modern cloud native application needs to be reactive, responsive by adopting the <a href=reactive/ >reactive manifesto</a>. </p> <p>When adopting microservice implementation, the bounded context is defined with events and main business entity. Each microservice is responsible to manage the operations of creating, updating and reading the data from a main business entity. This clear separation, leads to exchange data between services, where they used to be integrated in the same monolytic application before.</p> <p>A web application, single page app (SPA), accesses the different microservices using RESTful APIs, to get the different data views, or create new data elements within one of the service.The following diagram illustrates a simple view of the microservice challenges:</p> <p><img alt=1 src=diagrams/microserv-1.drawio.png></p> <p>When the user interface exposes entry form to create new data for one of the business entity, it calls a REST end point with a HTTP POST operation, then data are saved to data store: document oriented database or SQL based RDBMS.</p> <p>When a microservice (1) needs to access data from another service, it calls another service end point via an HTTP GET. Coupling still exists, via the protocol and the data schema definition level: a change to the data model, from the source microservice, impacts the service contract and so all the API consumers. This may be acceptable when there is few microservices, but could become a real pain when the number increase.</p> <p>When the microservice dependencies grows in size and complexity, as illustrated by the following figure from <a href=https://monzo.com/blog/we-built-network-isolation-for-1-500-services>Jack Kleeman's Monzo study</a>, we can see any change to the API from adding a new function will impact all the related services, and will increase cost to maintain such complexity:</p> <p><img alt=2 src=images/microserv-2.png></p> <p>Finally, imagine we need to join data coming from two different services to address an urgent business request. Who will implement the join, service A or B? May be the simplest is to add a service C and implement a join: it will call two API end points, and try to reconcile data using primary keys on both business entities. With this clear separation we can scale service C, but we still add coupling:</p> <p><img alt=3 src=diagrams/microserv-3.drawio.png></p> <p>With event-driven microservices, the communication point becomes the Pub/Sub layer of the event backbone. Adopting an event-based implementation, enhances the loose coupling nature of microservices because it decouples producers and consumers at the protocol level. The figure below illustrates, that microservices A and B produces facts about their business entities to topic in the pub/sub event backbone:</p> <p><img alt=4 src=diagrams/microserv-4.drawio.png></p> <p>The microservice C consumes those facts to build, its own projections to support the join query.</p> <p>When adopting technology like Kafka as messaging backbone, the data sharing is done via an event log, which can be kept for a very long time period, and is replayable to improve resilience. </p> <p>These event-driven characteristic is an important decision we need to take when starting developing microservices. Microservice applications are a combination of synchronous API, and asynchronous, event-driven, communication. </p> <p>There is something important to add to the discussion, is the fact that there is a coupling by the data. Messaging structures are defined with JSON schema or Avro schema and managed inside a Schema registry, so messaging applications can still manage the data contract. </p> <p>The following figure presents a potential structure for event-driven microservice: </p> <p>In Java, APIs are defined using microprofile OpenAPI annotations in one or more JAXRS resource classes. Those APIs can then be managed within an API management product:</p> <p><img alt src=images/evt-driv-ms.png width=300></p> <p>The rest of the application structure reflects the DDD approach of onion architecture. The business logic is in its own layer with DDD aggregate, ubiquitous language, services, business rules, etcâ€¦ The repository layer supports persisting those aggregates to an external document-oriented or SQL-based database. As most of the new microservices are message-driven, we are adding a messaging layer that may use queues or topics. Use queue for request/response exactly once delivery and topic for sharing facts in append log. In Java, the Microprofile Reactive Messaging is used to define the different publishing channels, being queue, topic, or both. From the JSON or Avro schema defining the messages or events structure, developers can build an AsyncAPI specification which may also be managed by an API product.</p> <h2 id=common-patterns>Common Patterns<a class=headerlink href=#common-patterns title="Permanent link">&para;</a></h2> <p>Adopting messaging (Pub/Sub or queueing) as a microservice communication approach involves using, at least, the following patterns:</p> <ul> <li><a href=https://microservices.io/patterns/decomposition/decompose-by-subdomain.html>Decompose by subdomain</a>: The domain-driven design approach is useful to identify and classify business functions and the corresponding microservices that would be associated with them. With the event storming method, aggregates help to find those subdomains of responsibility. (Source Chris Richardson - Microservices Patterns)</li> <li><a href=https://microservices.io/patterns/data/database-per-service.html>Database per service</a>: Each service persists data privately and is accessible only via its API. Services are loosely coupled limiting impact to other services when schema changes occur in the database. The chosen database technology is driven by business requirements. (Source Chris Richardson - Microservices Patterns) The implementation of transactions that span multiple services is complex and enforces using the Saga pattern. Queries that span multiple entities are a challenge and CQRS represents an interesting solution.</li> <li><a href=#strangler-pattern>Strangler pattern</a>: Used to incrementally migrate an existing, monolithic, application by replacing a set of features to a microservice but keep both running in parallel. Applying a domain driven design approach, you may strangle the application using bounded context. But then as soon as this pattern is applied, you need to assess the co-existence between existing bounded contexts and the new microservices. One of the challenges will be to define where the write and read operations occurs, and how data should be replicated between the contexts. This is where event driven architecture helps.</li> <li><a href=#scatter-gather>Scatter-gather</a> to dispatch work among microservice and gather their results to build an aggregated answer.</li> <li><a href=event-sourcing/ >Event sourcing</a>: persists, to an append log, the states of a business entity, such as an Order, as a sequence of immutable state-changing events.</li> <li><a href=#choreography>Choreography</a> to do decentralized coordination between services.</li> <li><a href=#orchestration>Orchestration</a> to centralize the coordination between distributed systems with compensation flow.</li> <li><a href=cqrs/ >Command Query Responsibility Segregation</a>: helps to separate queries from commands and help to address queries with cross-microservice boundary.</li> <li><a href=saga/ >Saga pattern:</a> Microservices publish events when something happens in the scope of their control like an update in the business entities they are responsible for. A microservice, interested in other business entities, subscribes to those events and it can update its own state and business entities on receipt of these events. Business entity keys need to be unique and immutable.</li> <li><a href=dlq/ >Event reprocessing with dead letter</a>: event driven microservices may have to call external services via a synchronous call. We need to process failure in order to get response from those services using event backbone.</li> <li><a href=#transactional-outbox>Transactional outbox</a>: A service command typically needs to update the database and send messages/events. The approach is to use an outbox table to keep the message to sent and a message relay process to publish events inserted into database to the event backbone. (Source Chris Richardson - Microservices Patterns)</li> </ul> <h2 id=strangler-pattern>Strangler pattern<a class=headerlink href=#strangler-pattern title="Permanent link">&para;</a></h2> <h3 id=problem>Problem<a class=headerlink href=#problem title="Permanent link">&para;</a></h3> <p>How to migrate a monolithic application to a microservice based architecture without doing the huge effort of redeveloping the application from a blank slate. Replacing and rewriting an existing application can be a huge investment. Rewriting a subset of business functions while running current application in parallel may be relevant and reduce risk and velocity of changes.</p> <p>The figure below illustrates a typical mainframe application, with external Java based user interface connected to the mainframe via iop/corba and with three different applications to manage product, order and customer.</p> <p><img alt=1 src=images/strangler.png width=500></p> <h3 id=solution>Solution<a class=headerlink href=#solution title="Permanent link">&para;</a></h3> <p>The approach is to use a "strangler" interface to dispatch a request to new or old features. Existing features to migrate are selected by trying to isolate sub components.</p> <p>One of main challenges is to isolate the data store and disover how the new microservices and the legacy application are accessing the shared data. Continuous data replication can be a solution to propagate write model to read model. Write model will most likely stays on the monolitic application, change data capture can be used, with event backbone to propagate change to read model.</p> <p>The facade needs to be scalable and not a single point of failure. It needs to support new APIs (RESTful) and old API (most likely SOAP).</p> <p>The following figure illustrates an implementation using an event driven solution with data replication to synchronize the write model to the read model on the mainframe.</p> <p><img alt=2 src=images/strangler-2.png width=1000></p> <h2 id=choreography>Choreography<a class=headerlink href=#choreography title="Permanent link">&para;</a></h2> <p>Service choreography and service orchestration are two different approaches to coordinating the interactions and behaviors of distributed services. </p> <p>Service choreography refers to a decentralized coordination approach where each participating service in a system collaborates autonomously, following predefined rules or processes. Services interact directly with each other, exchanging messages and performing actions based on the received messages.There is no central coordinator. It emphasizes the autonomy and independence of each service, allowing for more flexibility and scalability. Service choreography can be compared to a dance, where each participant knows their steps and responds to the cues from others.</p> <p>It is more complex to implement to manage the exception and error recovery. The process model on top of this choreography is more difficult to understand and model. Reverse engineering the service traces to build the story of what happened to a given business transaction.</p> <p>With event routing based middlewares, the event pushes to services participing to the choreography is done via routing rules. So the business process flow is controlled by the routing policies.</p> <p>Here is an example of choreography with squares representing events from the different services, and topics to keep events related to the same entity: CarRideOrders, AutonomousCar, Customers, Payments</p> <p><img alt src=images/choreography.drawio.png width=700></p> <p>The detail of the flow is described in <a href=../solutions/autonomous-car/#carridemanager>this design note</a></p> <h2 id=orchestration>Orchestration<a class=headerlink href=#orchestration title="Permanent link">&para;</a></h2> <p>Service orchestration, is a centralized coordination approach where a central entity, known as an orchestrator or process engine, controls and coordinates the interactions between the participating services. The orchestrator defines the flow of activities, sequences, and conditions that govern the execution of the services. It actively manages the interactions, determining the order of service invocations, handling exception and compensation scenarios, and ensuring the overall process logic is followed. Service orchestration provides a higher level of control and visibility over the execution flow but may introduce a single point of failure or performance bottleneck. In the world of SOA, BPEL engines were used for orchestration, with long running transactions. Java supports </p> <h2 id=scatter-gather>Scatter-gather<a class=headerlink href=#scatter-gather title="Permanent link">&para;</a></h2> <p>This is a common pattern to facilitate parallel processing and aggregation of results from multiple sources. It was created with the adoption of distributed systems, and is well adapted for microservice solutions. The data to process is scattered across different nodes or microservices, processed independently, and then gathered or collected back together for further processing or presentation.</p> <p>The pattern consists of two main phases: the scatter phase and the gather phase.</p> <ul> <li> <p><strong>Scatter Phase</strong>: In this phase, a central entity (often referred to as the scatterer) divides the incoming data into smaller chunks and distributes them across multiple processing units or nodes. When using event the data is the event payload. Each processing unit is responsible for handling a portion of the data independently, without requiring coordination with the others. This enables parallel processing and helps in optimizing performance.</p> </li> <li> <p><strong>Gather Phase:</strong> Once the scatter phase completes, the processing units return their results to the central entity or a designated gathering component. The gatherer collects the intermediate results and combines them to produce the final result or output. The combination can involve simple aggregation, such as summing up values, or more complex operations like merging and sorting.</p> </li> </ul> <p><img alt src=images/scatter-gather.drawio.png width=700></p> <h2 id=transactional-outbox>Transactional outbox<a class=headerlink href=#transactional-outbox title="Permanent link">&para;</a></h2> <p>When distributed transaction is not supported by the messaging middleware (like current Kafka version), it is important to ensure consistency between the records in the database and the events published. In the reference implementation we used the approach to publish to the topic as soon as an order is received via the API and then the same code, is consuming this events to persist to the database. With this approach if write to the topic operation fails, the application can return an error to the user, if the write operation to the database fails, the code can reload from the non-committed record. </p> <p>But there is another solution presented by the transactional outbox. For detailed information about this pattern see the documentation of the pattern in Chris Richardson's site: <a href=https://microservices.io/patterns/data/transactional-outbox.html>Transactional outbox</a>.</p> <p>To summarize this pattern, the approach is to use an <code>outbox</code> table to keep the messages to sent and a message relay process to publish events inserted into database to the event backbone. In modern solution this relay is a change data capture agent. The following schema illustrates the approach:</p> <p><img alt=3 src=images/outbox.png width=700></p> <h2 id=integration-patterns>Integration patterns<a class=headerlink href=#integration-patterns title="Permanent link">&para;</a></h2> <h3 id=one-way-asynchronous>One-way asynchronous<a class=headerlink href=#one-way-asynchronous title="Permanent link">&para;</a></h3> <p>The sender does not expect a response, and share its information to a message channel</p> <p><img alt src=diagrams/p2p-mq-jms.drawio.png></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../methodology/event-storming/vaccine-dt-es-ddd/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Vaccine Examples"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Vaccine Examples </div> </div> </a> <a href=events-versus-messages/ class="md-footer__link md-footer__link--next" aria-label="Next: Messaging vs events"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Messaging vs events </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2018 - 2024 Jerome Boyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/jbcodeforce target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/jeromeboyer target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.tooltips", "content.code.copy", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=../javascripts/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>