<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://jeromeboyer.net/eda-studies/techno/mirrormaker/ rel=canonical><link href=../confluent/ rel=prev><link href=../../solutions/autonomous-car/es-duplicate-evt/ rel=next><link rel=icon href=../../images/logo-blue.drawio.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Mirror Maker 2 - Event-Driven Solutions in Hybrid Cloud - Jerome Boyer</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kafka-mirror-maker-2 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" class="md-header__button md-logo" aria-label="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" data-md-component=logo> <img src=../../images/logo.drawio.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Event-Driven Solutions in Hybrid Cloud - Jerome Boyer </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Mirror Maker 2 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/eda-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../concepts/eda/ class=md-tabs__link> EDA concepts </a> </li> <li class=md-tabs__item> <a href=../../methodology/event-storming/ class=md-tabs__link> Methodology </a> </li> <li class=md-tabs__item> <a href=../../patterns/ class=md-tabs__link> Design patterns </a> </li> <li class=md-tabs__item> <a href=../../methodology/getting-started/ class=md-tabs__link> Demonstrations </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../kafka/ class=md-tabs__link> Technologies </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" class="md-nav__button md-logo" aria-label="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" data-md-component=logo> <img src=../../images/logo.drawio.png alt=logo> </a> Event-Driven Solutions in Hybrid Cloud - Jerome Boyer </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/eda-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> EDA concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> EDA concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/eda/ class=md-nav__link> <span class=md-ellipsis> Reference architecture </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/soa-eda/ class=md-nav__link> <span class=md-ellipsis> From SOA to EDA </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/backbone/ class=md-nav__link> <span class=md-ellipsis> Messaging backbone </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/legacy-itg/ class=md-nav__link> <span class=md-ellipsis> Legacy integration </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/data-pipeline/ class=md-nav__link> <span class=md-ellipsis> Data pipeline </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Methodology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> <span class=md-ellipsis> Event Storming </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/ddd/ class=md-nav__link> <span class=md-ellipsis> Domain driven design </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/ddd/eda_assessment/ class=md-nav__link> <span class=md-ellipsis> EDA Assessment </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/event-storming/vaccine-dt-es-ddd/ class=md-nav__link> <span class=md-ellipsis> Vaccine Examples </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Design patterns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Design patterns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/ class=md-nav__link> <span class=md-ellipsis> Common patterns </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/events-versus-messages/ class=md-nav__link> <span class=md-ellipsis> Messaging vs events </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/model/ class=md-nav__link> <span class=md-ellipsis> Devising the data models </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> <span class=md-ellipsis> API management </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> <span class=md-ellipsis> Saga </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> <span class=md-ellipsis> Event Sourcing </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> <span class=md-ellipsis> CQRS </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/reactive/ class=md-nav__link> <span class=md-ellipsis> Reactive </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/flow-architectures/ class=md-nav__link> <span class=md-ellipsis> Flow architecture </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> <span class=md-ellipsis> Dead letter queue </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/data-lineage/ class=md-nav__link> <span class=md-ellipsis> Data lineage </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/governance/ class=md-nav__link> <span class=md-ellipsis> Governance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Demonstrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Demonstrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../kafka/playground/ class=md-nav__link> <span class=md-ellipsis> Sandbox notes </span> </a> </li> <li class=md-nav__item> <a href=../../solutions/gitops_IaC/ class=md-nav__link> <span class=md-ellipsis> GitOps - IaC </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/eda-rt-inventory/ class=md-nav__link> <span class=md-ellipsis> Real-time Inventory </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Technologies </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Technologies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kafka/ class=md-nav__link> <span class=md-ellipsis> Kafka </span> </a> </li> <li class=md-nav__item> <a href=../kafka/faq/ class=md-nav__link> <span class=md-ellipsis> Kafka FAQ </span> </a> </li> <li class=md-nav__item> <a href=../kafka/producer/ class=md-nav__link> <span class=md-ellipsis> Kafka Producer </span> </a> </li> <li class=md-nav__item> <a href=../kafka/consumer/ class=md-nav__link> <span class=md-ellipsis> Kafka Consumer </span> </a> </li> <li class=md-nav__item> <a href=../kafka/security/ class=md-nav__link> <span class=md-ellipsis> Kafka Security </span> </a> </li> <li class=md-nav__item> <a href=../avro-schemas/ class=md-nav__link> <span class=md-ellipsis> Schema Mgt </span> </a> </li> <li class=md-nav__item> <a href=../kstreams/ class=md-nav__link> <span class=md-ellipsis> Kafka Streams </span> </a> </li> <li class=md-nav__item> <a href=../kafka-connect/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=../confluent/ class=md-nav__link> <span class=md-ellipsis> Confluent </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/redpanda-studies/ class=md-nav__link> <span class=md-ellipsis> RedPanda </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Mirror Maker 2 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Mirror Maker 2 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#mirror-maker-2-components class=md-nav__link> <span class=md-ellipsis> Mirror Maker 2 components </span> </a> <nav class=md-nav aria-label="Mirror Maker 2 components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-replicating class=md-nav__link> <span class=md-ellipsis> Why replicating? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deployment-examples class=md-nav__link> <span class=md-ellipsis> Deployment examples </span> </a> </li> <li class=md-nav__item> <a href=#replication-considerations class=md-nav__link> <span class=md-ellipsis> Replication considerations </span> </a> <nav class=md-nav aria-label="Replication considerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#topic-metadata-replication class=md-nav__link> <span class=md-ellipsis> Topic metadata replication </span> </a> </li> <li class=md-nav__item> <a href=#naming-convention class=md-nav__link> <span class=md-ellipsis> Naming convention </span> </a> </li> <li class=md-nav__item> <a href=#offset-management class=md-nav__link> <span class=md-ellipsis> Offset management </span> </a> </li> <li class=md-nav__item> <a href=#record-duplication class=md-nav__link> <span class=md-ellipsis> Record duplication </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mm2-topology class=md-nav__link> <span class=md-ellipsis> MM2 topology </span> </a> </li> <li class=md-nav__item> <a href=#consumer-coding class=md-nav__link> <span class=md-ellipsis> Consumer coding </span> </a> </li> <li class=md-nav__item> <a href=#capacity-planning class=md-nav__link> <span class=md-ellipsis> Capacity planning </span> </a> </li> <li class=md-nav__item> <a href=#version-migration class=md-nav__link> <span class=md-ellipsis> Version migration </span> </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> <span class=md-ellipsis> Resources </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/flink-studies class=md-nav__link> <span class=md-ellipsis> Flink </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/activemq/ class=md-nav__link> <span class=md-ellipsis> Active MQ </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Rabbit MQ </span> </a> </li> <li class=md-nav__item> <a href=../../solutions/autonomous-car/es-duplicate-evt/ class=md-nav__link> <span class=md-ellipsis> AWS duplicate with EB </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/yarfba/kinesis class=md-nav__link> <span class=md-ellipsis> AWS Kinesis </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/yarfba/serverless/msk class=md-nav__link> <span class=md-ellipsis> AWS MSK </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study class=md-nav__link> <span class=md-ellipsis> AWS messaging </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/sqs/ class=md-nav__link> <span class=md-ellipsis> AWS SQS </span> </a> </li> <li class=md-nav__item> <a href=../../ibm-assets/ class=md-nav__link> <span class=md-ellipsis> IBM Assets </span> </a> </li> <li class=md-nav__item> <a href=../ibm-mq/ class=md-nav__link> <span class=md-ellipsis> IBM MQ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#mirror-maker-2-components class=md-nav__link> <span class=md-ellipsis> Mirror Maker 2 components </span> </a> <nav class=md-nav aria-label="Mirror Maker 2 components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-replicating class=md-nav__link> <span class=md-ellipsis> Why replicating? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deployment-examples class=md-nav__link> <span class=md-ellipsis> Deployment examples </span> </a> </li> <li class=md-nav__item> <a href=#replication-considerations class=md-nav__link> <span class=md-ellipsis> Replication considerations </span> </a> <nav class=md-nav aria-label="Replication considerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#topic-metadata-replication class=md-nav__link> <span class=md-ellipsis> Topic metadata replication </span> </a> </li> <li class=md-nav__item> <a href=#naming-convention class=md-nav__link> <span class=md-ellipsis> Naming convention </span> </a> </li> <li class=md-nav__item> <a href=#offset-management class=md-nav__link> <span class=md-ellipsis> Offset management </span> </a> </li> <li class=md-nav__item> <a href=#record-duplication class=md-nav__link> <span class=md-ellipsis> Record duplication </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mm2-topology class=md-nav__link> <span class=md-ellipsis> MM2 topology </span> </a> </li> <li class=md-nav__item> <a href=#consumer-coding class=md-nav__link> <span class=md-ellipsis> Consumer coding </span> </a> </li> <li class=md-nav__item> <a href=#capacity-planning class=md-nav__link> <span class=md-ellipsis> Capacity planning </span> </a> </li> <li class=md-nav__item> <a href=#version-migration class=md-nav__link> <span class=md-ellipsis> Version migration </span> </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> <span class=md-ellipsis> Resources </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kafka-mirror-maker-2>Kafka Mirror Maker 2<a class=headerlink href=#kafka-mirror-maker-2 title="Permanent link">&para;</a></h1> <div class="admonition warning"> <p class=admonition-title>Under construction</p> </div> <p>This section introduces <a href=https://kafka.apache.org/documentation/#georeplication-overview><strong>Mirror Maker 2.0</strong></a>, a replication feature of Kafka 2.4, detailing its usage and best practices for data replication between two Kafka clusters. Mirror Maker 2.0 was defined as part of the Kafka Improvement Process - <a href=https://cwiki.apache.org/confluence/display/KAFKA/KIP-382%3A+MirrorMaker+2.0>KIP 382</a> - and can be used for disaster recovery (active / passive) or for more complex topologies involving multiple Kafka Clusters to support an "always-on" architecture.</p> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <ul> <li>Mirror Maker is built on top of Kafka Connect and and is designed to replicate topics and consumer group metadata while preserving partitioning.</li> <li>At least two Kafka clusters are established: one designated as the source in the active region and another as the target for disaster recovery or passive use.</li> <li>The source cluster hosts producer and consumer applications, which can be deployed either within the same Kubernetes cluster or on VMs, accessing Kafka brokers.</li> <li>Producer, consumer, or streaming applications deployed in Kubernetes connect to the Kafka broker using the <code>bootstrap URL</code>, defined through an internal service. For example, it may look like <code>es-prod-kafka-bootstrap.ibm-eventstreams.svc.</code> This configuration ensures that the settings remain consistent across the target cluster.</li> <li>Kubernetes / OpenShift clusters are defined across three data centers, with a well-structured distribution. For a clearer understanding of the golden topology for OpenShift, refer to the following diagram, which illustrates the deployment of master and worker nodes.</li> </ul> <p><img alt src=images/k8s-golden-topo.png></p> <ul> <li>The target cluster hosts a MirrorMaker cluster, which operates based on the Kafka Connect framework.</li> </ul> <p>The following diagram illustrates those principles:</p> <p><img alt src=diagrams/principles.drawio.png></p> <p>When zooming in on the replication details, we can observe the source topics from the blue cluster being replicated to the target topics on the green cluster. This configuration is designed for disaster recovery, utilizing an active-passive model. In this setup, only the left side has active applications that are producing and consuming records from the Kafka topics.</p> <p><img alt=1 src=diagrams/mm2-dr.drawio.png></p> <p>Since the mirroring occurs over longer internet distances, some latency in data replication is to be expected.</p> <p>We can enhance this deployment by utilizing MirrorMaker 2 to replicate data across multiple clusters in a more active-active configuration. The following diagram illustrates the concepts for an "always-on" deployment:</p> <p><img alt=2 src=diagrams/mm2-multi-cluster.drawio.png></p> <p>This model can also being used between cloud providers.</p> <p>In active-active mode, data is injected into the local cluster while replicated data is received from the remote cluster. The topic names are prefixed with the original cluster name. In the figure below, the cluster on the right features green local producers and consumers, with topics being replicated to the left into the blue cluster. Similarly, topics from the blue cluster on the left are replicated to the right</p> <p><img alt=3 src=diagrams/mm2-act-act.drawio.png></p> <p>Consumers on both sides receive data from the <code>orders</code> topics (both local and replicated) to gain a comprehensive view of all orders created across both clusters.</p> <p>The following diagram provides a closer look at a classic web-based solution design, where mobile or web applications interact with a web tier to serve single-page applications, static content, and APIs.</p> <p><img alt src=diagrams/classic-n-tier.drawio.png></p> <p>A set of microservices implements the business logic, with some services being event-driven, producing and consuming events from topics. With active-active replication in place, the same topology is deployed in another data center, allowing data from the same topic (representing a business entity) to arrive at the replicated topic. Each service can then store the record in its own database and cache. (The service tier does not detail the expected replicas, and the application load balancer does not display routes to the other data center.)</p> <p>In the event of a failure on one side of the data replication, the data remains transparently accessible. A read model query will yield consistent results on both sides.</p> <p>In replication, the data within the topics, as well as topic states and metadata, are replicated.</p> <hr> <h2 id=mirror-maker-2-components>Mirror Maker 2 components<a class=headerlink href=#mirror-maker-2-components title="Permanent link">&para;</a></h2> <p><a href=https://strimzi.io/docs/operators/in-development/configuring.html#assembly-deployment-configuration-kafka-mirror-maker-str>Mirror maker 2.0</a> is the solution to replicate data in topics from one Kafka cluster to another. It uses the <a href=../kafka-connect/ >Kafka Connect</a> framework to simplify configuration, parallel execution and horizontal scaling.</p> <p>The figure below illustrates the MirrorMaker 2.0 internal components running within Kafka Connect.</p> <p><img alt="Kafka Connect" src=images/mm-k-connect.png></p> <p>MirrorMaker 2 uses the cluster name or identifier as prefix for topic, and uses the concept of source topic and target topic. It runs in standalone mode, which can be used for development and test purpose, or in distributed mode (cluster) for production deployment. With distribution mode, MirrorMaker 2.0 creates the following topics on the cluster it is connected to (See later the property <code>connectCluster</code>):</p> <ul> <li><strong>...-configs.source.internal</strong>: This topic is used to store the connector and task configuration.</li> <li><strong>...-offsets.source.internal</strong>: This topic is used to store offsets for Kafka Connect.</li> <li><strong>...-status.source.internal</strong>: This topic is used to store status updates of connectors and tasks.</li> <li><strong>source.heartbeats</strong>: to check that the remote cluster is available and the clusters are connected</li> <li>*<em>source.checkpoints.internal</em>: MirrorCheckpointConnector tracks and maps offsets for specified consumer groups using an offset sync topic and checkpoint topic.</li> </ul> <p>A typical MirrorMaker 2.0 configuration is done via a property file and defines the replication source and target clusters with their connection properties and the replication flow definition. Here is a simple example for a local cluster replicating to a remote IBM Event Streams cluster using TLS v1.2 for connection encryption and SASL authentication protocol. The IBM Event Streams instance runs on the Cloud.</p> <div class="language-properties highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=na>clusters</span><span class=o>=</span><span class=s>source, target</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=na>source.bootstrap.servers</span><span class=o>=</span><span class=s>${KAFKA_SOURCE_BROKERS}</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=na>target.bootstrap.servers</span><span class=o>=</span><span class=s>${KAFKA_TARGET_BROKERS}</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=na>target.security.protocol</span><span class=o>=</span><span class=s>SASL_SSL</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=na>target.ssl.protocol</span><span class=o>=</span><span class=s>TLSv1.2</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=na>target.ssl.endpoint.identification.algorithm</span><span class=o>=</span><span class=s>https</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=na>target.sasl.mechanism</span><span class=o>=</span><span class=s>PLAIN</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=na>target.sasl.jaas.config</span><span class=o>=</span><span class=s>org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;token&quot; password=${KAFKA_TARGET_APIKEY};</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=c1># enable and configure individual replication flows</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=na>source-&gt;target.enabled</span><span class=o>=</span><span class=s>true</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=na>source-&gt;target.topics</span><span class=o>=</span><span class=s>products</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=na>tasks.max</span><span class=o>=</span><span class=s>10</span>
</span></code></pre></div> <ul> <li>Topics to be replicated are configured via a <em>whitelist</em> that may include regular expression for pattern matching on the topic name. So if you use naming convention for your topic, you could do fine grained selection of the replicated topic. It is possible to specify topics you do not want to replicate via the <em>blacklist</em> property.</li> <li>White listed topics are set with the <code>source-&gt;target.topics</code> attribute of the replication flow and uses <a href=https://www.vogella.com/tutorials/JavaRegularExpressions/article.html>Java regular expression</a> syntax.</li> <li>The default blacklisted topics are Kafka internal topic:</li> </ul> <div class="language-properties highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=na>blacklist</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>[follower</span><span class=se>\.</span><span class=s>replication</span><span class=se>\.</span><span class=s>throttled</span><span class=se>\.</span><span class=s>replicas, leader</span><span class=se>\.</span><span class=s>replication</span><span class=se>\.</span><span class=s>throttled</span><span class=se>\.</span><span class=s>replicas, message</span><span class=se>\.</span><span class=s>timestamp</span><span class=se>\.</span><span class=s>difference</span><span class=se>\.</span><span class=s>max</span><span class=se>\.</span><span class=s>ms, message</span><span class=se>\.</span><span class=s>timestamp</span><span class=se>\.</span><span class=s>type, unclean</span><span class=se>\.</span><span class=s>leader</span><span class=se>\.</span><span class=s>election</span><span class=se>\.</span><span class=s>enable, min</span><span class=se>\.</span><span class=s>insync</span><span class=se>\.</span><span class=s>replicas]</span>
</span></code></pre></div> <p>We can also define the <em>blacklist</em> with the properties: <code>topics.blacklist</code>. Comma-separated lists and Java Regular Expressions are supported.</p> <p>Internally, <code>MirrorSourceConnector</code> and <code>MirrorCheckpointConnector</code> will create multiple Kafka tasks (up to the value of <code>tasks.max</code> property), and <code>MirrorHeartbeatConnector</code> creates an additional task. <code>MirrorSourceConnector</code> will have one task per topic-partition combination to replicate, while <code>MirrorCheckpointConnector</code> will have one task per consumer group. The Kafka Connect framework uses the coordinator API, with the <code>assign()</code> API, so there is no consumer group used while fetching data from source topics. There is no call to <code>commit()</code> either; rebalancing occurs only when there is a new topic created that matches the <em>whitelist</em> pattern.</p> <p>Mirror Maker 2 can run on VM, bare metal or within containers deployed on kubernetes cluster.</p> <h3 id=why-replicating>Why replicating?<a class=headerlink href=#why-replicating title="Permanent link">&para;</a></h3> <p>The classical needs for replication between clusters can be listed as:</p> <ul> <li>Disaster recovery when one secondary cluster is passive while the producer and consumers are on the active cluster in the primary data center: The <a href="https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-disaster_recovery_scenario">following article</a> goes over those principals.</li> <li>Active-active cluster mirroring for inter services communication: consumers and producers are on both sides and consume or produce to their local cluster.</li> <li>Moving data to a read only cluster as a front door to data lake, or to do cross data centers aggregation on the different event streams: Fan-in to get holistic data view.</li> <li>GDPR compliance to isolate data in country and geography</li> <li>Hybrid cloud operations to share data between on-premise cluster and managed service clusters.</li> </ul> <h2 id=deployment-examples>Deployment examples<a class=headerlink href=#deployment-examples title="Permanent link">&para;</a></h2> <p>We encourage you to go over our <a href=../../use-cases/kafka-mm2/ >Mirror maker 2 labs</a> which addresses different replication scenarios. The <code>Connect</code> column defines where the Mirror Maker 2 runs.</p> <table> <thead> <tr> <th>Scenario</th> <th>Source</th> <th>Target</th> <th style="text-align: center;">Connect</th> <th style="text-align: center;">Lab</th> </tr> </thead> <tbody> <tr> <td>Getting Started</td> <td></td> <td></td> <td style="text-align: center;"></td> <td style="text-align: center;"></td> </tr> <tr> <td>Lab 1</td> <td>Event Streams on Cloud</td> <td>Local Kafka</td> <td style="text-align: center;">Local on localhost</td> <td style="text-align: center;"><a href=../../use-cases/kafka-mm2/lab-1/ >Kafka Mirror Maker 2 - Lab 1</a></td> </tr> <tr> <td>Lab 2</td> <td>Using Mirror Maker 2 from Event Streams on premise to Event stream on cloud</td> <td>On OCP</td> <td style="text-align: center;">OCP</td> <td style="text-align: center;"><a href=../../use-cases/kafka-mm2/lab-2/ >Kafka Mirror Maker 2 - Lab 2</a></td> </tr> </tbody> </table> <h2 id=replication-considerations>Replication considerations<a class=headerlink href=#replication-considerations title="Permanent link">&para;</a></h2> <h3 id=topic-metadata-replication>Topic metadata replication<a class=headerlink href=#topic-metadata-replication title="Permanent link">&para;</a></h3> <p>It is possible to disable the topic metadata replication. We do not encourage to do so. Per design topic can be added dynamically, specially when developing with Kafka Streams where intermediate topics are created by the stream topology semantic, and topic configuration can be altered to increase the number of partitions. Changes to the source topic are dynamically propagated to the target avoiding maintenance nightmare. By synchronizing configuration properties, the need for rebalancing is reduced.</p> <p>When doing manual configuration, even if the initial topic configuration is duplicated, any dynamic changes to the topic properties are not going to be automatically propagated and the administrator needs to change the target topic. If the throughput on the source topic has increased and the number of partition was increased to support the load, then the target cluster will not have the same downstream capability which may lead to overloading (disk space or memory capacity). With a GitOps approach, this risk is mitigated as topic definition in the GitOps repository could be propagated to the target and source cluster mostly at the same time. </p> <p>Also if the consumer of a partition is expecting to process the events in order within the partition, then changing the number of partitions between source and target will make the ordering not valid any more.</p> <p>If the replication factor are set differently between the two clusters then the availability guaranty of the replicated data may be impacted and bad settings with broker failure will lead to data lost.</p> <p>Finally, it is important to consider that changes to topic configuration triggers a consumer rebalance which stalls the mirroring process and creates a backlog in the pipeline and increases the end to end latency observed by the downstream application.</p> <h3 id=naming-convention>Naming convention<a class=headerlink href=#naming-convention title="Permanent link">&para;</a></h3> <p>Mirror maker 2 sets the prefix for the name of the replicated topic with the name of the source cluster. This is an important and simple solution to avoid infinite loop when doing bi-directional mirroring. At the consumer side the <code>subscribe()</code> function supports regular expression for topic name. So a code like:</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>kafkaConsumer</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=s>&quot;^.*accounts&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>will listen to all the topics in the cluster having cluster name prefixed topics and the local <code>accounts</code> topic. This could be useful when we want to aggregate data from different data centers / clusters.</p> <h3 id=offset-management>Offset management<a class=headerlink href=#offset-management title="Permanent link">&para;</a></h3> <p>Mirror maker 2 tracks offset per consumer group. There are two topics created on the target cluster to manage the offset mapping between the source and target clusters and the checkpoints of the last committed offset in the source topic/partitions/consumer group. When a producer sends its records, it gets the offsets in the partition the records were created.</p> <p>In the diagram below we have a source topic A/partition 1 with the last write offset done by a producer to be 5, and the last read committed offset by the consumer assigned to partition 1 being 3. The last replicated offset 3 is mapped as downstream offset 12 in the target partition. Offset numbers do not match between replicated partitions. So if the blue consumer needs to reconnect to the green target cluster it will read from the last committed offset which is 12 in this environment. This information is saved in the <code>checkpoint</code> topic.</p> <p><img alt=6 src=images/mm2-offset-mgt.png></p> <p>Offset synch are emitted at the beginning of the replication and when there is a situation which leads that the numbering sequencing diverges. For example, the normal behavior is to increase the offset by one 2,3,4,5,6,7, which is mapped to 12,13,14,15,16,... on target cluster. If the write operation for offset 20 at the source is a 17 on the target then MM 2 emits a new offset synch records to the <code>offset-synch</code> topic.</p> <p>The <code>checkpoint</code> and <code>offset_synch</code> topics enable replication to be fully restored from the correct offset position on failover. On the following diagram, once the cluster source is down, the consumers on the target cluster are restarted, and they will start from the last committed offset of the source, which was offset 3 that is in fact offset 12 on target replicated topic. No record skipped.</p> <p><img alt=7 src=images/mm2-offset-mgt-2.png></p> <h3 id=record-duplication>Record duplication<a class=headerlink href=#record-duplication title="Permanent link">&para;</a></h3> <p>Exactly-once delivery is difficult to achieve in distributed system. In the case of Kafka, producer, brokers, and consumers are working together to ensure only one message is processed end to end. With coding practice and configuration settings, within a unique cluster, Kafka can guarantee exactly once processing. No duplicated records between producer and broker, and committed reads, on consumer side, are not reprocessed in case of consumer restarts.</p> <p>But for cross cluster replications, the semantic is based on at least once approach. Duplicates can happen when the mirror maker source task stops before committing its offset to the source topic. A restart will load records from the last committed offset which can generate duplicates. The following diagram illustrate this case, record offset 26 on target topic is a duplicate of record 25.</p> <p><img alt=8 src=images/mm2-dup.png></p> <p>Also Mirror Maker 2 is a generic topic consumer, it will not participate to the "read-committed" process, if the topic includes duplicate messages it will propagate them to the target.</p> <p>In the future MM2 will be able to support exactly once by using the <code>checkpoint</code> topic on the target cluster to keep the state of the committed offset from the consumer side, and write with an atomic transaction between the target topic and the checkpoint topic, and commit the source read offset as part of the same transaction.</p> <h2 id=mm2-topology>MM2 topology<a class=headerlink href=#mm2-topology title="Permanent link">&para;</a></h2> <p>In this section we want to address horizontal scalability and how to organize the MirrorMaker 2 topology for multi-tenancy. The simplest approach is to use one Mirror Maker instance per family of topics: the classification of family of topic can be anything, from line of business, to team, to application. Suppose an application is using 1000 topic - partitions, for data replication it may make sense to have one MM2 instance for this application. The configuration will define the groupId to match the application name for example.</p> <p>The following diagram illustrates this kind of topology by using regular expression on the topic white list selection, there are three Mirror Maker 2 instances mirroring the different topics with name starting with <code>topic-name-A*, topic-name-B*, topic-name-C*,</code> respectively.</p> <p><img alt=9 src=images/mm2-topology.png></p> <p>Each connect instance is a JVM workers that replicate the topic/partitions and has different group.id.</p> <p>For Bi-directional replication for the same topic name, Mirror Maker 2 will use the cluster name as prefix. With MM2, we do not need to have 2 MM2 clusters but only one and bidirectional definitions. The following example is showing the configuration for a MM2 bidirectional settings, with <code>accounts</code> topic to be replicated on both cluster:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>apiVersion: kafka.strimzi.io/v1alpha1
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>kind: KafkaMirrorMaker2
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>...
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a> mirrors:
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>  - sourceCluster: &quot;event-streams-wdc&quot;
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    targetCluster: &quot;kafka-on-premise&quot;
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    ...
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>    topicsPattern: &quot;accounts,orders&quot;
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>  - sourceCluster: &quot;kafka-on-premise&quot;
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    targetCluster: &quot;event-streams-wdc&quot;
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>    ...
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    topicsPattern: &quot;accounts,customers&quot;
</span></code></pre></div> <h2 id=consumer-coding>Consumer coding<a class=headerlink href=#consumer-coding title="Permanent link">&para;</a></h2> <p>We recommend to review the <a href=../kafka/producer/ >producer implementation best practices</a> and the <a href=../kafka/consumer/ >consumer considerations</a>.</p> <h2 id=capacity-planning>Capacity planning<a class=headerlink href=#capacity-planning title="Permanent link">&para;</a></h2> <p>For platform sizing, the main metric to assess, is the number of partitions to replicate. The number of partitions and number of brokers are somehow connected as getting a high number of partitions involves increasing the number of brokers. For Mirror Maker 2, as it is based on Kafka connect, there is a unique cluster and each partition mirroring is supported by a task within the JVM so the first constraint is the memory allocated to the container and the heap size.</p> <p>To address capacity planning, we need to review some characteristic of the Kafka Connect framework: For each topic/partition there will be a task running. We can see in the trace that tasks are mapped to threads inside the JVM. So the parallelism will be bound by the number of CPUs the JVM runs on. The parameters <code>max.tasks</code> specifies the max parallel processing we can have per JVM. So for each Topic we need to assess the number of partitions to be replicated. Each task is using the consumer API and is part of the same consumer group, the partition within a group are balanced by an internal controller. With Kafka connect any changes to the topic topology triggers a partition rebalancing. In MM2 each consumer / task is assigned a partition by the controller. So the rebalancing is done internally. Still adding a broker node into the cluster will generate rebalancing.</p> <p>The task processing is stateless, consume - produce wait for acknowledge, commit offset. In this case, the CPU and network performance are key. For platform tuning activity, we need to monitor operating system performance metrics. If the CPU becomes the bottleneck, we can allocate more CPU or start to scale horizontally by adding more Mirror Maker 2 instances. If the network at the server level is the bottleneck, then adding more servers will help. Kafka will automatically balance the load among all the tasks running on all the machines. The size of the message impacts also the throughput as with small message the throughput is CPU bounded. With 100 bytes messages or more we can observe network saturation.</p> <p>The parameters to consider for sizing are the following:</p> <table> <thead> <tr> <th>Parameter</th> <th>Description</th> <th>Impact</th> </tr> </thead> <tbody> <tr> <td>Number of topic/ partition</td> <td>Each task processes one partition</td> <td>For pure parallel processing max.tasks is set around the number of CPU</td> </tr> <tr> <td>Record size</td> <td>Size of the message in each partition in average</td> <td>Memory usage and Throughput: the # of records/s decrease when size increase, while MB/s throughput increases in logarithmic</td> </tr> <tr> <td>Expected input throughput</td> <td>The producer writing to the source topic throughput</td> <td>Be sure the consumers inside MM2 absorb the demand</td> </tr> <tr> <td>Network latency</td> <td></td> <td>This is where positioning MM2 close to the target cluster may help improve latency</td> </tr> </tbody> </table> <h2 id=version-migration>Version migration<a class=headerlink href=#version-migration title="Permanent link">&para;</a></h2> <p>Once the Mirror Maker cluster is up and running, it may be needed to update the underlying code when a new product version is released. Based on Kafka Connect distributed mode multiple workers JVM coordinate the topic / partition repartition among themselves. If a worker process dies, the cluster is rebalanced to distribute the work fairly over the remaining workers. If a new worker starts work, a rebalance ensures it takes over some work from the existing workers.</p> <p>Using the REST API it is possible to stop and restart a connector. As of now the recommendation is to start a new MirrorMaker instance with the new version and the same groupId as the existing workers you want to migrate. Then stop the existing version. As each MirrorMaker workers are part of the same group, the internal worker controller will coordinate with the other workers the 'consumer' task to partition assignment.</p> <p>First we will stop the Node 1 instance, upgrade it to the latest version, then start it again. Then we’ll repeat the same procedure on Node 2. We’ll continue to watch the Consumer VM window to note that replication should not stop at any point.</p> <p><img alt=10 src=images/mm2-v2v-1.png></p> <p>We’ve now upgraded to Kafka 2.5 including the latest MirrorMaker 2. Meanwhile, replication was uninterrupted due to the second instance of MirrorMaker 2:</p> <p><img alt=11 src=images/mm2-v2v-2.png></p> <p>Now we’ll restart the Node 1 instance of MirrorMaker 2, stop the Node 2 instance, we can still see replication occurring on the upgraded Node 1 instance of MirrorMaker 2.</p> <p><img alt=12 src=images/mm2-v2v-3.png></p> <p>We upgrade Node 2’s instance of MirrorMaker 2 exactly as on Node 1, and start it again, and once again, replication is still going.</p> <p><img alt=13 src=images/mm2-v2v-4.png></p> <p>When using Strimzi, if the update applies to the MM2 Custom Resource Definition, just reapplying the CRD should be enough.</p> <p>Be sure to verify the product documentation as new version may enforce to have new topics. It was the case when Kafka connect added the config topic in a recent version.</p> <h2 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">&para;</a></h2> <ul> <li><a href=https://ibm.github.io/event-streams/georeplication/about/ >IBM Event Streams product documentation</a></li> <li><a href="https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-disaster_recovery_scenario">IBM Event Streams managed service - Disaster recovery example scenario</a></li> <li><a href=https://strimzi.io/docs/operators/latest/configuring.html#assembly-deployment-configuration-kafka-mirror-maker-str>Strimzi configuration for Mirror Maker 2</a></li> <li><a href=https://ibm-cloud-architecture.github.io/eda-tech-academy/getting-started/mm2/ >Getting started with Mirror Maker 2 - Tech Academy</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../confluent/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Confluent"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Confluent </div> </div> </a> <a href=../../solutions/autonomous-car/es-duplicate-evt/ class="md-footer__link md-footer__link--next" aria-label="Next: AWS duplicate with EB"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> AWS duplicate with EB </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2018 - 2024 Jerome Boyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/jbcodeforce target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/jeromeboyer target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "content.code.copy", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>