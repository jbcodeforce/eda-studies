<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://jeromeboyer.net/eda-studies/techno/kstreams/ rel=canonical><link href=../avro-schemas/ rel=prev><link href=../kafka-connect/ rel=next><link rel=icon href=../../images/logo-blue.drawio.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Kafka Streams - Event-Driven Solutions in Hybrid Cloud - Jerome Boyer</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kafka-streams class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" class="md-header__button md-logo" aria-label="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" data-md-component=logo> <img src=../../images/logo.drawio.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Event-Driven Solutions in Hybrid Cloud - Jerome Boyer </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kafka Streams </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/eda-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../concepts/eda/ class=md-tabs__link> EDA concepts </a> </li> <li class=md-tabs__item> <a href=../../methodology/event-storming/ class=md-tabs__link> Methodology </a> </li> <li class=md-tabs__item> <a href=../../patterns/ class=md-tabs__link> Design patterns </a> </li> <li class=md-tabs__item> <a href=../../methodology/getting-started/ class=md-tabs__link> Demonstrations </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../kafka/ class=md-tabs__link> Technologies </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" class="md-nav__button md-logo" aria-label="Event-Driven Solutions in Hybrid Cloud - Jerome Boyer" data-md-component=logo> <img src=../../images/logo.drawio.png alt=logo> </a> Event-Driven Solutions in Hybrid Cloud - Jerome Boyer </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/eda-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> EDA concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> EDA concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/eda/ class=md-nav__link> <span class=md-ellipsis> Reference architecture </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/soa-eda/ class=md-nav__link> <span class=md-ellipsis> From SOA to EDA </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/backbone/ class=md-nav__link> <span class=md-ellipsis> Messaging backbone </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/legacy-itg/ class=md-nav__link> <span class=md-ellipsis> Legacy integration </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/data-pipeline/ class=md-nav__link> <span class=md-ellipsis> Data pipeline </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Methodology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> <span class=md-ellipsis> Event Storming </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/ddd/ class=md-nav__link> <span class=md-ellipsis> Domain driven design </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/ddd/eda_assessment/ class=md-nav__link> <span class=md-ellipsis> EDA Assessment </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/event-storming/vaccine-dt-es-ddd/ class=md-nav__link> <span class=md-ellipsis> Vaccine Examples </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Design patterns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Design patterns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/ class=md-nav__link> <span class=md-ellipsis> Common patterns </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/events-versus-messages/ class=md-nav__link> <span class=md-ellipsis> Messaging vs events </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/model/ class=md-nav__link> <span class=md-ellipsis> Devising the data models </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> <span class=md-ellipsis> API management </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> <span class=md-ellipsis> Saga </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> <span class=md-ellipsis> Event Sourcing </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> <span class=md-ellipsis> CQRS </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/reactive/ class=md-nav__link> <span class=md-ellipsis> Reactive </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/flow-architectures/ class=md-nav__link> <span class=md-ellipsis> Flow architecture </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> <span class=md-ellipsis> Dead letter queue </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/data-lineage/ class=md-nav__link> <span class=md-ellipsis> Data lineage </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/governance/ class=md-nav__link> <span class=md-ellipsis> Governance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Demonstrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Demonstrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../kafka/playground/ class=md-nav__link> <span class=md-ellipsis> Sandbox notes </span> </a> </li> <li class=md-nav__item> <a href=../../solutions/gitops_IaC/ class=md-nav__link> <span class=md-ellipsis> GitOps - IaC </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/eda-rt-inventory/ class=md-nav__link> <span class=md-ellipsis> Real-time Inventory </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Technologies </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Technologies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kafka/ class=md-nav__link> <span class=md-ellipsis> Kafka </span> </a> </li> <li class=md-nav__item> <a href=../kafka/faq/ class=md-nav__link> <span class=md-ellipsis> Kafka FAQ </span> </a> </li> <li class=md-nav__item> <a href=../kafka/producer/ class=md-nav__link> <span class=md-ellipsis> Kafka Producer </span> </a> </li> <li class=md-nav__item> <a href=../kafka/consumer/ class=md-nav__link> <span class=md-ellipsis> Kafka Consumer </span> </a> </li> <li class=md-nav__item> <a href=../kafka/security/ class=md-nav__link> <span class=md-ellipsis> Kafka Security </span> </a> </li> <li class=md-nav__item> <a href=../avro-schemas/ class=md-nav__link> <span class=md-ellipsis> Schema Mgt </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kafka Streams </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kafka Streams </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#concepts class=md-nav__link> <span class=md-ellipsis> Concepts </span> </a> <nav class=md-nav aria-label=Concepts> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fault-tolerance class=md-nav__link> <span class=md-ellipsis> Fault tolerance </span> </a> </li> <li class=md-nav__item> <a href=#scaling class=md-nav__link> <span class=md-ellipsis> Scaling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#code-structure class=md-nav__link> <span class=md-ellipsis> Code structure </span> </a> </li> <li class=md-nav__item> <a href=#available-tutorials class=md-nav__link> <span class=md-ellipsis> Available tutorials </span> </a> </li> <li class=md-nav__item> <a href=#interactive-queries class=md-nav__link> <span class=md-ellipsis> Interactive queries </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations class=md-nav__link> <span class=md-ellipsis> Design considerations </span> </a> </li> <li class=md-nav__item> <a href=#faust-a-python-library-to-do-kafka-streaming class=md-nav__link> <span class=md-ellipsis> Faust: a python library to do kafka streaming </span> </a> </li> <li class=md-nav__item> <a href=#further-readings class=md-nav__link> <span class=md-ellipsis> Further readings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../kafka-connect/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=../confluent/ class=md-nav__link> <span class=md-ellipsis> Confluent </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/redpanda-studies/ class=md-nav__link> <span class=md-ellipsis> RedPanda </span> </a> </li> <li class=md-nav__item> <a href=../mirrormaker/ class=md-nav__link> <span class=md-ellipsis> Mirror Maker 2 </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/flink-studies class=md-nav__link> <span class=md-ellipsis> Flink </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/activemq/ class=md-nav__link> <span class=md-ellipsis> Active MQ </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Rabbit MQ </span> </a> </li> <li class=md-nav__item> <a href=../../solutions/autonomous-car/es-duplicate-evt/ class=md-nav__link> <span class=md-ellipsis> AWS duplicate with EB </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/yarfba/kinesis class=md-nav__link> <span class=md-ellipsis> AWS Kinesis </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/yarfba/serverless/msk class=md-nav__link> <span class=md-ellipsis> AWS MSK </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study class=md-nav__link> <span class=md-ellipsis> AWS messaging </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study/sqs/ class=md-nav__link> <span class=md-ellipsis> AWS SQS </span> </a> </li> <li class=md-nav__item> <a href=../../ibm-assets/ class=md-nav__link> <span class=md-ellipsis> IBM Assets </span> </a> </li> <li class=md-nav__item> <a href=../ibm-mq/ class=md-nav__link> <span class=md-ellipsis> IBM MQ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#concepts class=md-nav__link> <span class=md-ellipsis> Concepts </span> </a> <nav class=md-nav aria-label=Concepts> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fault-tolerance class=md-nav__link> <span class=md-ellipsis> Fault tolerance </span> </a> </li> <li class=md-nav__item> <a href=#scaling class=md-nav__link> <span class=md-ellipsis> Scaling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#code-structure class=md-nav__link> <span class=md-ellipsis> Code structure </span> </a> </li> <li class=md-nav__item> <a href=#available-tutorials class=md-nav__link> <span class=md-ellipsis> Available tutorials </span> </a> </li> <li class=md-nav__item> <a href=#interactive-queries class=md-nav__link> <span class=md-ellipsis> Interactive queries </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations class=md-nav__link> <span class=md-ellipsis> Design considerations </span> </a> </li> <li class=md-nav__item> <a href=#faust-a-python-library-to-do-kafka-streaming class=md-nav__link> <span class=md-ellipsis> Faust: a python library to do kafka streaming </span> </a> </li> <li class=md-nav__item> <a href=#further-readings class=md-nav__link> <span class=md-ellipsis> Further readings </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kafka-streams>Kafka Streams<a class=headerlink href=#kafka-streams title="Permanent link">&para;</a></h1> <p>Kafka Streams is client API to build microservices with input and output data are in Kafka. It is based on programming a graph of processing nodes to support the business logic developer wants to apply on the event streams. </p> <p>We recommend reading this excellent introduction <a href=https://www.confluent.io/blog/introducing-kafka-streams-stream-processing-made-simple/ >Kafka stream made simple</a> from Jay Kreps from Confluent to get a good understanding of why Kafka stream was created.</p> <h2 id=concepts>Concepts<a class=headerlink href=#concepts title="Permanent link">&para;</a></h2> <p>The business logic is implemented via <strong>topology</strong> which represents a graph of processing nodes. Each node within the graph, processes events from the parent node. </p> <p>To summarize, <strong>Kafka Streams</strong> has the following capabilities:</p> <ul> <li>Kafka Streams applications are built on top of the producer and consumer Kafka APIs and are leveraging Kafka capabilities to do data parallelism processing, support distributed coordination of partition to task assignment, and being fault tolerant.</li> <li>Kafka supports exactly-once processing semantics to guarantee that each record is processed once and only once even when there is a failure.</li> <li>Streams processing is helpful for handling out-of-order data, <em>reprocessing</em> input as code changes, and performing stateful computations, like real time analytics. It uses stateful storage and consumer groups. It treats both past and future data the same way.</li> <li>Kafka Streams is an embedded library to integrate in any Java application. No need for separate processing cluster. As deployable container, it can scale horizontally easily within Kubernetes platform. It does not run in Kafka cluster.</li> <li>Topology consumes continuous real time flows of records and publishes new flows to one or more topics.</li> <li>A stream (represented by the KStream API) is a durable, partitioned sequence of immutable events. When a new event is added a stream, it's appended to the partition that its key belongs to.</li> <li>It can scale vertically, by increasing the number of threads for each Kafka Streams application on a single machine, and horizontally by adding additional machines or pods in kubernetes. Each deployed instance use the same value for the <code>application.id</code> kafka stream property.</li> </ul> <p><img alt=1 src=diagrams/kstreams-parallel.drawio.png width=600></p> <p>The assignment of stream partitions to stream tasks never changes, so task is the unit of parallelism. Task executes the topology, and is buffering records coming from the attached partitions. </p> <ul> <li><strong>KTable</strong> is a durable, partitioned collection that models change over time. It's the mutable counterpart of <strong>KStreams</strong>. It represents what is true at the current moment. Each data record is considered a contextual update. Tables are saved in state store backed up with kafka topic and may be queried. Any operation on the table such as querying, inserting, or updating a row is carried out behind the scenes by a corresponding operation on the table’s state store.</li> </ul> <p>These state stores are being materialized on local disk inside the application instances</p> <p><img alt=2 src=diagrams/kstreams-store.drawio.png width=500></p> <ul> <li>Stream APIs transform, aggregate and enrich data, per record with millisecond latency, from one topic to another one.</li> <li>Supports stateful and windowing operations by processing one record at a time.</li> <li>An application's processor topology is scaled by breaking it into multiple tasks.</li> <li>Tasks can then instantiate their own processor topology based on the assigned partitions.</li> </ul> <p><img alt=3 src=images/kafka-stream-arch.png></p> <h3 id=fault-tolerance>Fault tolerance<a class=headerlink href=#fault-tolerance title="Permanent link">&para;</a></h3> <p>As <strong>KTables</strong> are persisted on state store, they are materialized on local to broker disk, as change log streams:</p> <p><img alt=4 src=diagrams/kstreams-fault.drawio.png></p> <p>In the case of a stream processing task fails, it can rebuild its internal, in memory state store, from the kafka topic / change log (1). Once done it can consume messages again (2). The system is fault tolerant.</p> <h3 id=scaling>Scaling<a class=headerlink href=#scaling title="Permanent link">&para;</a></h3> <p>When topics have multiple partitions, each kafka streams task consumes a unique partition. </p> <p><img alt=5 src=images/kstreams-scale-1.png></p> <p>If for any reasons, we need to scale by adding new instances of the application, so in term of kubernetes, adding more pods, then the system will rebalance the stream tasks allocation to new instances created.</p> <p><img alt=6 src=images/kstreams-scale-2.png></p> <p>We can start as many threads of the application as there are input Kafka topic partitions.</p> <p>Another good example to illustrate threading, task and machine scaling is documented in this <a href=https://docs.confluent.io/current/streams/architecture.html#example>on Confluent article</a>.</p> <h2 id=code-structure>Code structure<a class=headerlink href=#code-structure title="Permanent link">&para;</a></h2> <p>In general the code for processing event does the following:</p> <ul> <li>Set a properties object to specify which brokers to connect to and what kind of key and value des/serialization mechanisms to use.</li> <li>Define a stream client: if you want to get the stream of records use <strong>KStream</strong>. If you want a changelog with the last value of a given key, use <strong>KTable</strong> (For example, using KTable to keep a user profile data by userid key).</li> <li>Create a topology of input source and sink target and the set of actions to perform in between.</li> <li>Start the stream client to consume records.</li> </ul> <p>Programming with <strong>KStream</strong> and <strong>Ktable</strong> is not easy at first, as there are a lot of concepts for data manipulations, serialization and operations chaining. Code size stays on the low size.</p> <p>A stateful operator uses the streaming Domain Specific Language, with constructs for aggregation, join and time window operations. Stateful transformations require a state store associated with the stream processor.</p> <p>We recommend at this stage to do our <a href=https://jbcodeforce.github.io/eda-tech-academy/lab2/ >exercise 1 from the Tech Academy tutorial</a> to develop a first simple topology and test it without any Kafka cluster using the <code>Topology test driver</code>.</p> <p>The following code extract, is part of the Apache Kafka Word count example and is used to illustrate the programming model used: </p> <div class="language-java highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// Streams processing are created from a builder.</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kd>final</span><span class=w> </span><span class=n>StreamsBuilder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StreamsBuilder</span><span class=p>();</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=c1>// pattern to extract word</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kd>final</span><span class=w> </span><span class=n>Pattern</span><span class=w> </span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pattern</span><span class=p>.</span><span class=na>compile</span><span class=p>(</span><span class=s>&quot;\\W+&quot;</span><span class=p>);</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=c1>// source is a kafka topic, and materialized as a KStream</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=n>KStream</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>textLines</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>source</span><span class=p>);</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1>// implement the logic to count words</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=n>KTable</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=n>wordCounts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>textLines</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>    </span><span class=p>.</span><span class=na>flatMapValues</span><span class=p>(</span><span class=n>textLine</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=n>pattern</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=n>textLine</span><span class=p>.</span><span class=na>toLowerCase</span><span class=p>())))</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>    </span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>Printed</span><span class=p>.</span><span class=na>toSysOut</span><span class=p>())</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=p>.</span><span class=na>groupBy</span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>word</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>word</span><span class=p>)</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=p>.</span><span class=na>count</span><span class=p>(</span><span class=n>Materialized</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=p>,</span><span class=w> </span><span class=n>KeyValueStore</span><span class=o>&lt;</span><span class=n>Bytes</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;&gt;</span><span class=n>as</span><span class=p>(</span><span class=s>&quot;counts-store&quot;</span><span class=p>));</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=c1>// sink is another kafka topic. Produce for each word the number of occurrence in the given doc</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=n>wordCounts</span><span class=p>.</span><span class=na>toStream</span><span class=p>().</span><span class=na>to</span><span class=p>(</span><span class=n>sink</span><span class=p>,</span><span class=w> </span><span class=n>Produced</span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>(),</span><span class=w> </span><span class=n>Serdes</span><span class=p>.</span><span class=na>Long</span><span class=p>()));</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=n>KafkaStreams</span><span class=w> </span><span class=n>streams</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>KafkaStreams</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>(),</span><span class=w> </span><span class=n>props</span><span class=p>);</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=n>streams</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span></code></pre></div> <ul> <li><a href=https://kafka.apache.org/38/javadoc/org/apache/kafka/streams/kstream/KStream.html>KStream</a> represents KeyValue records coming as event stream from the input topic.</li> <li><code>flatMapValues()</code> transforms the value of each record in "this" stream into zero or more values with the same key in a new KStream (in memory). So here the text line is split into words. The parameter is a <a href=https://kafka.apache.org/38/javadoc/org/apache/kafka/streams/kstream/ValueMapper.html>ValueMapper</a> which applies transformation on values but keeps the key. Another important transformation is the <a href=https://kafka.apache.org/38/javadoc/org/apache/kafka/streams/kstream/KeyValueMapper.html>KeyValueMapper</a>.</li> <li><code>groupBy()</code> Group the records of this KStream on a new key that is selected using the provided KeyValueMapper. So here it creates new KStream with the extracted word as key.</li> <li><code>count()</code> counts the number of records in this stream by the grouped key. <code>Materialized</code> is an class to define a "store" to persist state and data. So here the state store is "counts-store". As store is a in-memory table, but it could also be persisted in external database. Could be the Facebook's <a href=https://rocksdb.org/ >RocksDB key value persistence</a> or a log-compacted topic in Kafka.</li> <li>Produced defines how to provide the optional parameter types when producing to new topics.</li> <li>KTable is an abstraction of a changelog stream from a primary-keyed table.</li> </ul> <p>Important: map, flatMapValues and mapValues ... functions don’t modify the object or value presented as a parameter.</p> <h2 id=available-tutorials>Available tutorials<a class=headerlink href=#available-tutorials title="Permanent link">&para;</a></h2> <p>We found the following tutorial helpful to grow your competency on Kafka Streams:</p> <ul> <li><a href=https://kafka.apache.org/38/documentation/streams/tutorial>Word count Kafka Stream example from product documentation</a></li> <li><a href=../use-cases/kafka-streams/lab-1>Use Quarkus and Kafka Streams to use groupBy, join with another Stream</a></li> <li><a href=https://quarkus.io/guides/kafka-streams>Quarkus and Kafka Streams guides</a></li> <li><a href=../../use-cases/kafka-streams/lab-3>Build an inventory aggregator with Quarkus, with kstreams, ktable and interactive queries, Mutiny</a>, all deployable on OpenShift with quarkus kubernetes plugin.</li> </ul> <h2 id=interactive-queries>Interactive queries<a class=headerlink href=#interactive-queries title="Permanent link">&para;</a></h2> <p>State store can be queried, and this is supported by <a href=https://kafka.apache.org/10/documentation/streams/developer-guide/interactive-queries.html>the interactive queries</a>. Result can be from the local store, if the key is in the local store, or a remote one. The metadata of the key to task allocation is maintained and shared between tasks. </p> <p>As a Kafka stream app runs on multiple instances, the entire state of the app is distributed among the instances. </p> <p>The Stream topology will transform the stream to table with one of the groupBy or aggregate operation:</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>items</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=p>.</span><span class=na>groupByKey</span><span class=p>(</span><span class=n>ItemStream</span><span class=p>.</span><span class=na>buildGroupDefinition</span><span class=p>())</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=p>.</span><span class=na>aggregate</span><span class=p>(</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w>  </span><span class=k>new</span><span class=w> </span><span class=n>Inventory</span><span class=p>(),</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=p>(</span><span class=n>k</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>newItem</span><span class=p>,</span><span class=w> </span><span class=n>existingInventory</span><span class=p>)</span><span class=w> </span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>        </span><span class=o>-&gt;</span><span class=w> </span><span class=n>existingInventory</span><span class=p>.</span><span class=na>updateStockQuantity</span><span class=p>(</span><span class=n>k</span><span class=p>,</span><span class=n>newItem</span><span class=p>),</span><span class=w> </span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>        </span><span class=n>InventoryAggregate</span><span class=p>.</span><span class=na>materializeAsInventoryStore</span><span class=p>());</span><span class=w> </span>
</span></code></pre></div> <p>which then it can be materialized as queryable key - value store.</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1>// class InventoryAggregate</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=cm>/**</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=cm> * Create a key value store named INVENTORY_STORE_NAME to persist store inventory</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=cm> */</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Materialized</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Inventory</span><span class=p>,</span><span class=w> </span><span class=n>KeyValueStore</span><span class=o>&lt;</span><span class=n>Bytes</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;&gt;</span><span class=w> </span><span class=nf>materializeAsInventoryStore</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Materialized</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Inventory</span><span class=p>,</span><span class=w> </span><span class=n>KeyValueStore</span><span class=o>&lt;</span><span class=n>Bytes</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;&gt;</span><span class=n>as</span><span class=p>(</span><span class=n>INVENTORY_STORE_NAME</span><span class=p>)</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>            </span><span class=p>.</span><span class=na>withKeySerde</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>()).</span><span class=na>withValueSerde</span><span class=p>(</span><span class=n>inventorySerde</span><span class=p>);</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=p>}</span>
</span></code></pre></div> <p>Each store is local to the instance it was created in:</p> <p><img alt=9 src=https://kafka.apache.org/10/images/streams-interactive-queries-api-01.png></p> <p>The storeID is the key used in the KTable. Once the Kafka Stream is started and store created (loop to get it ready) then it is easy to access it:</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nd>@Inject</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>KafkaStreams</span><span class=w> </span><span class=n>streams</span><span class=p>;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=kd>private</span><span class=w> </span><span class=n>ReadOnlyKeyValueStore</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Inventory</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getInventoryStockStore</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>                </span><span class=n>StoreQueryParameters</span><span class=o>&lt;</span><span class=n>ReadOnlyKeyValueStore</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=n>Inventory</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>parameters</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StoreQueryParameters</span><span class=p>.</span><span class=na>fromNameAndType</span><span class=p>(</span><span class=n>InventoryAggregate</span><span class=p>.</span><span class=na>INVENTORY_STORE_NAME</span><span class=p>,</span><span class=n>QueryableStoreTypes</span><span class=p>.</span><span class=na>keyValueStore</span><span class=p>());</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>streams</span><span class=p>.</span><span class=na>store</span><span class=p>(</span><span class=n>parameters</span><span class=p>);</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>        </span><span class=p>...</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=c1>// access one element of the store</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=n>Inventory</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getInventoryStockStore</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>storeID</span><span class=p>);</span>
</span></code></pre></div> <p>To get access to remote store, we need to expose each store via an API. The easiest one is a REST api, but it could be any RPC protocol. Each instance is uniquely identified via the <code>application.server</code> property. When deploying on kubernetes it could be the pod IP address accessible via the $POD_IP environment variable. </p> <p>Below is a Quarkus declaration:</p> <div class="language-properties highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=na>hostname</span><span class=o>=</span><span class=s>${POD_IP:localhost}</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=na>quarkus.kafka-streams.application-server</span><span class=o>=</span><span class=s>${hostname}:8080</span>
</span></code></pre></div> <p>Now the design decision is to return the URL of the remote instance to the client doing the query call or do the call internally to the instance reached to always returning a result.</p> <p>The knowledge of other application instance is done by sharing metadata. The following code example illustrates the access to metadata for store via the kafka stream context and then build a pipeline metadata to share information about host, port and partition allocation.</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>streams</span><span class=p>.</span><span class=na>allMetadataForStore</span><span class=p>(</span><span class=n>ItemStream</span><span class=p>.</span><span class=na>ITEMS_STORE_NAME</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>                </span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>                </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>m</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PipelineMetadata</span><span class=p>(</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>                        </span><span class=n>m</span><span class=p>.</span><span class=na>hostInfo</span><span class=p>().</span><span class=na>host</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;:&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=na>hostInfo</span><span class=p>().</span><span class=na>port</span><span class=p>(),</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>                        </span><span class=n>m</span><span class=p>.</span><span class=na>topicPartitions</span><span class=p>()</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>                                </span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>                                </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>TopicPartition</span><span class=p>::</span><span class=n>toString</span><span class=p>)</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>                                </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toSet</span><span class=p>())))</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>                </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span>
</span></code></pre></div> <h2 id=design-considerations>Design considerations<a class=headerlink href=#design-considerations title="Permanent link">&para;</a></h2> <ul> <li>Partitions are assigned to a StreamTask, and each StreamTask has its own state store. So it is important to use key and kafka will assign records with same key to same partition so lookup inside state store will work.</li> <li>Avoid external database lookup as part of the stream: As kafka can handle million of records per second, so a lookup to an external database to do a join between a primary key that is in the event and a table in the database to do a data enrichment, for example, is a bad practice. The approach will be to use Ktable, with state store and perform a join in memory.</li> <li>Reference data can be loaded inside a Ktable for event stream enrichment.</li> <li> <p>Table and streams joins: we recommend reading <a href=https://www.confluent.io/blog/crossing-streams-joins-apache-kafka/ >this deep dive article</a> on joining between streams and joining stream with table. The important points from this article:</p> <ul> <li>kstream - kstream joins are windowed to control the size of data to keep in memory to search for the matching records.</li> </ul> </li> </ul> <h2 id=faust-a-python-library-to-do-kafka-streaming>Faust: a python library to do kafka streaming<a class=headerlink href=#faust-a-python-library-to-do-kafka-streaming title="Permanent link">&para;</a></h2> <p><a href=https://faust.readthedocs.io/en/latest/index.html>Faust</a> is a python library to support stream processing. It does not have its own DSL as Kafka streams in Java has, but just python functions.</p> <p>It uses rocksdb to support tables.</p> <p>For the installation, in your python environment do a <code>pipenv run pip install faust</code>, or <code>pip install faust</code>. Then use faust as a CLI. So to start an agent as worker use:</p> <div class="language-shell highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>faust<span class=w> </span>-A<span class=w> </span>nameofthepythoncode<span class=w> </span>-l<span class=w> </span>info
</span></code></pre></div> <p>Multiple instances of a Faust worker can be started independently to distribute stream processing across machines and CPU cores.</p> <h2 id=further-readings>Further readings<a class=headerlink href=#further-readings title="Permanent link">&para;</a></h2> <ul> <li>The API and <a href=https://kafka.apache.org/38/documentation/streams/developer-guide/ >product documentation</a>.</li> <li><a href=https://docs.confluent.io/current/streams/concepts.html>Kafka Streams concepts from Confluent</a></li> <li><a href=https://www.michael-noll.com/blog/2018/04/05/of-stream-and-tables-in-kafka-and-stream-processing-part1/ >Deep dive explanation for the differences between KStream and KTable from Michael Noll</a></li> <li><a href=https://github.com/jbcodeforce/kafka-streams-samples>Our set of samples to getting started in coding kafka streams</a> </li> <li><a href=https://www.confluent.io/blog/distributed-real-time-joins-and-aggregations-on-user-activity-events-using-kafka-streams/ >Distributed, Real-time Joins and Aggregations using Kafka Stream, from Michael Noll at Confluent</a></li> <li><a href=https://docs.confluent.io/current/streams/index.html#kafka-streams>Confluent Kafka Streams documentation</a></li> <li><a href=https://docs.confluent.io/current/streams/architecture.html>Kafka Streams architecture article from Confluent</a>.</li> <li><a href=https://medium.com/@andy.bryant/kafka-streams-work-allocation-4f31c24753cc>Andy Bryant's article on kafka stream work allocation and sub-topologies</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../avro-schemas/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Schema Mgt"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Schema Mgt </div> </div> </a> <a href=../kafka-connect/ class="md-footer__link md-footer__link--next" aria-label="Next: Kafka Connect"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Kafka Connect </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2018 - 2024 Jerome Boyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/jbcodeforce target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/jeromeboyer target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "content.code.copy", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>